{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <h2>Download YouTube Playlist</h2>
        <form id="playlistForm" class="mt-4">
            <div class="mb-3">
                <label for="url" class="form-label">YouTube Playlist URL</label>
                <input type="url" class="form-control" id="url" name="url" required>
            </div>
            <button type="submit" class="btn btn-primary">Load Playlist</button>
        </form>

        <div id="playlistContent" class="mt-4" style="display: none;">
            <h3>Playlist Items</h3>
            <div class="progress mb-3" style="display: none;">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="playlistItems">
                </tbody>
            </table>
            <button id="downloadAll" class="btn btn-success">Download All</button>
        </div>
    </div>
</div>

<script>
document.getElementById('playlistForm').onsubmit = async (e) => {
    e.preventDefault();
    const url = document.getElementById('url').value;
    const playlistContent = document.getElementById('playlistContent');
    const playlistItems = document.getElementById('playlistItems');
    const progressBar = document.querySelector('.progress');
    const progressBarInner = document.querySelector('.progress-bar');

    try {
        const response = await fetch('/process-playlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `url=${encodeURIComponent(url)}`
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            playlistItems.innerHTML = '';
            data.videos.forEach(video => {
                playlistItems.innerHTML += `
                    <tr>
                        <td>${video.title}</td>
                        <td>
                            <span class="status">Pending</span>
                        </td>
                    </tr>
                `;
            });
            
            playlistContent.style.display = 'block';
            
            // Store videos data for later use
            window.playlistVideos = data.videos;
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        alert('Error loading playlist');
    }
};
</script>
{% endblock %} 